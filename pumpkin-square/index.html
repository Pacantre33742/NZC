<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Zinken Forge ‚Ä¢ Pumpkin Square (Trade)</title>
<meta name="description" content="–ú–∏–Ω–∏‚Äë—Ñ–µ—Ä–º–∞: –ø–æ—Å–∞–¥–∏—Ç—å ‚Üí –ø–æ–ª–∏—Ç—å ‚Üí –≤—ã—Ä–∞—Å—Ç–∏—Ç—å ‚Üí —Å–æ–±—Ä–∞—Ç—å. –°–µ–º–µ–Ω–∞, –≤–æ–¥–∞, –±–∏—Ä–∂–∞ —Å –ø–æ–∫—É–ø–∫–æ–π/–ø—Ä–æ–¥–∞–∂–µ–π, –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ.">
<style>
  :root{
    --bg:#0e0f12; --panel:#15171c; --text:#e9edf5; --muted:#9aa3b2; --line:#232733;
    --accent:#ff8a1f; --ok:#4be38a; --bad:#ff6b6b; --btn:#1b1f27; --btnh:#232836;
    --empty:#2a2f3a; --planted:#6b4c2f; --need:#1d3b52; --grow:#245b3a; --ripe:#a35614; --wither:#3a2c2c;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:14px/1.5 Inter,system-ui,Segoe UI,Roboto,Arial}
  header{position:sticky;top:0;z-index:6;background:linear-gradient(180deg,#0b0c10,rgba(11,12,16,.65));border-bottom:1px solid var(--line);backdrop-filter:blur(6px)}
  .wrap{max-width:1100px;margin:0 auto;padding:14px 16px;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .brand{font-weight:800;letter-spacing:.4px}
  .pill{margin-left:auto;display:flex;gap:12px;align-items:center;background:var(--panel);border:1px solid var(--line);padding:8px 12px;border-radius:10px}
  .pill b{color:var(--accent)}
  main{max-width:1100px;margin:18px auto;padding:0 16px}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:14px;margin-bottom:16px}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .btn{background:var(--btn);border:1px solid var(--line);color:var(--text);padding:9px 12px;border-radius:10px;cursor:pointer;transition:.15s}
  .btn:hover{background:var(--btnh)}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  .center{display:flex;justify-content:center;align-items:center}
  .square{width:240px;height:240px;border-radius:14px;display:flex;align-items:center;justify-content:center;
          border:2px dashed #2f3847;background:var(--empty);box-shadow:inset 0 0 30px rgba(0,0,0,.35)}
  .state{font-weight:700;letter-spacing:.5px;text-transform:uppercase;text-align:center}
  .small{font-size:12px;color:var(--muted)}
  .table{width:100%;border-collapse:collapse}
  .table th,.table td{border-bottom:1px solid var(--line);padding:8px 6px;text-align:left}
  .table th{color:var(--muted);font-weight:600}
  .priceUp{color:var(--ok)} .priceDn{color:var(--bad)}
  footer{max-width:1100px;margin:24px auto 36px;padding:0 16px;color:var(--muted);font-size:12px}
  .buy{border-color:#335b2f}
  .sell{border-color:#5b3a2f}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="brand">üéÉ Pumpkin Square</div>
    <div class="pill">
      –ë–∞–ª–∞–Ω—Å: <b id="money">$0</b> ‚Ä¢ üå± –°–µ–º–µ–Ω–∞: <b id="seeds">0</b> ‚Ä¢ üíß –í–æ–¥–∞: <b id="water">0</b> ‚Ä¢ –û–±—ã—á–Ω—ã–µ: <b id="raw">0</b> ‚Ä¢ –í—ã—Ä–µ–∑–∞–Ω–Ω—ã–µ: <b id="carved">0</b>
    </div>
  </div>
</header>

<main>
  <div class="card grid2">
    <div class="center">
      <div class="square" id="plot"><div class="state" id="stateText">–ü–£–°–¢–û</div></div>
    </div>
    <div>
      <h3 style="margin:0 0 10px">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
      <div class="row">
        <button class="btn" id="plantBtn">–ü–æ—Å–∞–¥–∏—Ç—å</button>
        <button class="btn" id="waterBtn">–ü–æ–ª–∏—Ç—å</button>
        <button class="btn" id="harvestBtn">–°–æ–±—Ä–∞—Ç—å</button>
      </div>
      <div class="small" id="timers" style="margin-top:8px"></div>
      <div class="row" style="margin-top:12px">
        <button class="btn" id="buySeed">–ö—É–ø–∏—Ç—å —Å–µ–º–µ–Ω–∞ ($20)</button>
        <button class="btn" id="buyWater">–ö—É–ø–∏—Ç—å –≤–æ–¥—É ($10)</button>
      </div>
      <p class="small">–¶–∏–∫–ª: –ø–æ—Å–∞–¥–∏—Ç—å ‚Üí (30—Å –Ω–∞ –ø–æ–ª–∏–≤) ‚Üí –ø–æ–ª–∏—Ç—å ‚Üí (60—Å —Ä–æ—Å—Ç) ‚Üí —Å–æ–±—Ä–∞—Ç—å. –ï—Å–ª–∏ –Ω–µ –ø–æ–ª–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 30—Å ‚Äî —É—Ä–æ–∂–∞–π –∑–∞—Å–æ—Ö–Ω–µ—Ç.</p>
    </div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 10px">–†–µ–∑–∫–∞</h3>
    <div class="row">
      <button class="btn" id="carve1">–í—ã—Ä–µ–∑–∞—Ç—å 1</button>
      <button class="btn" id="carveAll">–í—ã—Ä–µ–∑–∞—Ç—å –≤—Å—ë</button>
      <span class="small">1 –æ–±—ã—á–Ω–∞—è ‚Üí 1 –≤—ã—Ä–µ–∑–∞–Ω–Ω–∞—è</span>
    </div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 10px">–ë–∏—Ä–∂–∞ (—Å–æ —Å–ø–æ—Ç–æ–≤–æ–π –ø–æ–∫—É–ø–∫–æ–π)</h3>
    <table class="table">
      <thead><tr><th>–ê–∫—Ç–∏–≤</th><th>–¶–µ–Ω–∞</th><th>–î–æ—Å—Ç—É–ø–Ω–æ</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead>
      <tbody>
        <tr>
          <td>–û–±—ã—á–Ω–∞—è —Ç—ã–∫–≤–∞</td>
          <td id="pxRaw"></td>
          <td id="haveRaw"></td>
          <td>
            <div class="row">
              <button class="btn buy" id="buyRaw1">–ö—É–ø–∏—Ç—å 1</button>
              <button class="btn buy" id="buyRaw10">–ö—É–ø–∏—Ç—å 10</button>
              <button class="btn sell" id="sellRaw10">–ü—Ä–æ–¥–∞—Ç—å 10</button>
              <button class="btn sell" id="sellRawAll">–ü—Ä–æ–¥–∞—Ç—å –≤—Å—ë</button>
            </div>
          </td>
        </tr>
        <tr>
          <td>–í—ã—Ä–µ–∑–∞–Ω–Ω–∞—è —Ç—ã–∫–≤–∞</td>
          <td id="pxCarved"></td>
          <td id="haveCarved"></td>
          <td>
            <div class="row">
              <button class="btn buy" id="buyCarved1">–ö—É–ø–∏—Ç—å 1</button>
              <button class="btn buy" id="buyCarved10">–ö—É–ø–∏—Ç—å 10</button>
              <button class="btn sell" id="sellCarved10">–ü—Ä–æ–¥–∞—Ç—å 10</button>
              <button class="btn sell" id="sellCarvedAll">–ü—Ä–æ–¥–∞—Ç—å –≤—Å—ë</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="row" style="margin-top:8px">
      <button class="btn" id="tickNow">–û–±–Ω–æ–≤–∏—Ç—å –∫–æ—Ç–∏—Ä–æ–≤–∫–∏</button>
      <span class="small">–ö–æ—Ç–∏—Ä–æ–≤–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 60—Å: –æ–±—ã—á–Ω–∞—è ~ $20 (¬±5%), –≤—ã—Ä–µ–∑–∞–Ω–Ω–∞—è ~ $35 (¬±6%). –ü–æ–∫—É–ø–∫–∞ —Å–ø–∏—Å—ã–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å –ø–æ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω–µ.</span>
    </div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 10px">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</h3>
    <div class="row">
      <button class="btn" id="saveBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button class="btn" id="resetBtn">–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
      <button class="btn" id="exportBtn">–≠–∫—Å–ø–æ—Ä—Ç</button>
      <button class="btn" id="importBtn">–ò–º–ø–æ—Ä—Ç</button>
      <span class="small">–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥.</span>
    </div>
  </div>
</main>


  <div style="text-align:center;margin-top:20px;">
    <a href="https://zinkenforge.ru" class="btn" style="text-decoration:none;">‚¨ÖÔ∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å–∞–π—Ç</a>
  </div>

<footer>¬© 2025 Zinken Forge ‚Äî –≤—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</footer>

<script>
"use strict";

// ====== CONFIG ======
const CFG = {
  seedPrice: 20,
  waterPrice: 10,
  rawBase: 20, carvedBase: 35,
  rawVol:[-0.05,0.05], carvedVol:[-0.06,0.06],
  priceTickSec: 60,
  preWaterSec: 30, // –¥–æ –ø–æ–ª–∏–≤–∞
  growSec: 60,     // –ø–æ—Å–ª–µ –ø–æ–ª–∏–≤–∞
  autosaveSec: 15
};

// ====== STATE ======
let S = {
  money: 100,
  seeds: 3,
  water: 3,
  raw: 0,
  carved: 0,
  plot: {
    state: "EMPTY",
    plantedAt: 0,
    mustWaterUntil: 0,
    wateredAt: 0,
    ripeAt: 0
  },
  prices: { raw: 20, carved: 35 },
  lastDir: { raw: 0, carved: 0 },
  lastTick: Date.now()
};

// ====== SAVE ======
function save(){ localStorage.setItem("zf_pumpkin_square_trade", JSON.stringify(S)); }
function load(){
  try{
    const x = localStorage.getItem("zf_pumpkin_square_trade");
    if(x){ const d = JSON.parse(x); if(d && typeof d==="object"){ S = {...S, ...d}; } }
  }catch(e){}
}

// ====== UI helpers ======
const $ = s => document.querySelector(s);
function money(v){ return "$"+Number(v||0).toFixed(0); }
function setHeader(){
  $("#money").textContent = money(S.money);
  $("#seeds").textContent = S.seeds;
  $("#water").textContent = S.water;
  $("#raw").textContent = S.raw;
  $("#carved").textContent = S.carved;
}
function setPlotView(){
  const box = $("#plot");
  const t = $("#stateText");
  const timers = $("#timers");
  let txt="", bg= "var(--empty)";
  const now = Date.now();

  if(S.plot.state==="EMPTY"){ txt="–ü–£–°–¢–û"; bg="var(--empty)"; timers.textContent=""; }
  else if(S.plot.state==="PLANTED"){
    txt="–ü–û–°–ê–ñ–ï–ù–û";
    bg="var(--planted)";
    const left = Math.max(0, Math.ceil((S.plot.mustWaterUntil - now)/1000));
    timers.textContent = `‚è≥ –î–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–ª–∏–≤–∞: ${left}—Å`;
    if(now >= S.plot.mustWaterUntil){ S.plot.state="WITHERED"; }
  }
  else if(S.plot.state==="NEED_WATER"){
    txt="–ù–£–ñ–ù–û –ü–û–õ–ò–¢–¨";
    bg="var(--need)";
    const left = Math.max(0, Math.ceil((S.plot.mustWaterUntil - now)/1000));
    timers.textContent = `‚ö†Ô∏è –ü–æ–ª–µ–π—Ç–µ –≤ —Ç–µ—á–µ–Ω–∏–µ: ${left}—Å`;
    if(now >= S.plot.mustWaterUntil){ S.plot.state="WITHERED"; }
  }
  else if(S.plot.state==="GROWING"){
    txt="–†–ê–°–¢–Å–¢...";
    bg="var(--grow)";
    const left = Math.max(0, Math.ceil((S.plot.ripeAt - now)/1000));
    timers.textContent = `üå± –î–æ —Å–æ–∑—Ä–µ–≤–∞–Ω–∏—è: ${left}—Å`;
    if(now >= S.plot.ripeAt){ S.plot.state="RIPE"; }
  }
  else if(S.plot.state==="RIPE"){
    txt="–ì–û–¢–û–í–û –ö –°–ë–û–†–£!";
    bg="var(--ripe)"; timers.textContent="‚úÖ –ú–æ–∂–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å";
  }
  else if(S.plot.state==="WITHERED"){
    txt="–ó–ê–°–û–•–õ–û";
    bg="var(--wither)"; timers.textContent="üíÄ –£—Ä–æ–∂–∞–π –ø–æ–≥–∏–±. –°–æ–±–µ—Ä–∏—Ç–µ, —á—Ç–æ–±—ã –æ—á–∏—Å—Ç–∏—Ç—å –≥—Ä—è–¥–∫—É.";
  }

  box.style.background = bg;
  t.textContent = txt;
}
function setPrices(){
  const dirR = S.lastDir.raw, dirC = S.lastDir.carved;
  const r = $("#pxRaw"), c = $("#pxCarved");
  if(r) r.innerHTML = `<b class="${dirR>0?'priceUp':(dirR<0?'priceDn':'')}">${money(S.prices.raw)}</b>`;
  if(c) c.innerHTML = `<b class="${dirC>0?'priceUp':(dirC<0?'priceDn':'')}">${money(S.prices.carved)}</b>`;
  const hr = $("#haveRaw"), hc = $("#haveCarved");
  if(hr) hr.textContent = S.raw;
  if(hc) hc.textContent = S.carved;
}

// ====== PRICES ======
function clamp(v,min,max){ return Math.max(min, Math.min(max,v)); }
function tickPrices(force=false){
  const now = Date.now();
  if(!force && now - S.lastTick < CFG.priceTickSec*1000) return;
  S.lastTick = now;

  const upd = (key, base, vol)=>{
    const [lo,hi] = vol;
    const mult = 1 + (Math.random()*(hi-lo)+lo);
    const cur = S.prices[key]*mult;
    const next = clamp(cur, base*0.5, base*2.0);
    S.lastDir[key] = next> S.prices[key] ? 1 : (next< S.prices[key] ? -1 : 0);
    S.prices[key] = Math.round(next);
  };
  upd("raw", CFG.rawBase, CFG.rawVol);
  upd("carved", CFG.carvedBase, CFG.carvedVol);

  setPrices(); save();
}

// ====== ACTIONS (field) ======
function plant(){
  if(S.plot.state!=="EMPTY"){ alert("–ì—Ä—è–¥–∫–∞ –∑–∞–Ω—è—Ç–∞"); return; }
  if(S.seeds<=0){ alert("–ù–µ—Ç —Å–µ–º—è–Ω"); return; }
  S.seeds--;
  const now = Date.now();
  S.plot.state="PLANTED";
  S.plot.plantedAt = now;
  S.plot.mustWaterUntil = now + CFG.preWaterSec*1000;
  setHeader(); setPlotView(); save();
}

function water(){
  if(!(S.plot.state==="PLANTED" || S.plot.state==="NEED_WATER")){ alert("–ü–æ–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–ª–∏–≤"); return; }
  if(S.water<=0){ alert("–ù–µ—Ç –≤–æ–¥—ã"); return; }
  if(Date.now() > S.plot.mustWaterUntil){ S.plot.state="WITHERED"; setPlotView(); return; }
  S.water--;
  const now = Date.now();
  S.plot.state="GROWING";
  S.plot.wateredAt = now;
  S.plot.ripeAt = now + CFG.growSec*1000;
  setHeader(); setPlotView(); save();
}

function harvest(){
  if(S.plot.state==="RIPE"){
    S.raw++;
    S.plot.state="EMPTY";
  }else if(S.plot.state==="WITHERED"){
    S.plot.state="EMPTY"; // –æ—á–∏—â–∞–µ–º –≥—Ä—è–¥–∫—É
  }else{
    alert("–ï—â—ë —Ä–∞–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å");
    return;
  }
  setHeader(); setPlotView(); save();
}

// ====== ACTIONS (shop/resources) ======
function buySeed(){
  if(S.money<CFG.seedPrice){ alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤"); return; }
  S.money -= CFG.seedPrice; S.seeds++;
  setHeader(); save();
}
function buyWater(){
  if(S.money<CFG.waterPrice){ alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤"); return; }
  S.money -= CFG.waterPrice; S.water++;
  setHeader(); save();
}

// ====== ACTIONS (processing) ======
function carve(n){
  n = Math.min(n, S.raw);
  if(n<=0) return;
  S.raw -= n; S.carved += n;
  setHeader(); setPrices(); save();
}

// ====== ACTIONS (exchange) ======
function buyAsset(kind, n){
  const price = kind==="raw" ? S.prices.raw : S.prices.carved;
  const cost = price * n;
  if(S.money < cost){ alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤"); return; }
  S.money -= cost;
  if(kind==="raw") S.raw += n; else S.carved += n;
  setHeader(); setPrices(); save();
}
function sell(kind, n){
  if(kind==="raw"){ n=Math.min(n,S.raw); if(n<=0) return; S.raw-=n; S.money += Math.round(S.prices.raw*n); }
  else { n=Math.min(n,S.carved); if(n<=0) return; S.carved-=n; S.money += Math.round(S.prices.carved*n); }
  setHeader(); setPrices(); save();
}

// ====== BIND ======
function bind(){
  // field
  $("#plantBtn").onclick = plant;
  $("#waterBtn").onclick = water;
  $("#harvestBtn").onclick = harvest;
  // shop
  $("#buySeed").onclick = buySeed;
  $("#buyWater").onclick = buyWater;
  // processing
  $("#carve1").onclick = ()=>carve(1);
  $("#carveAll").onclick = ()=>carve(S.raw);
  // exchange buy/sell
  $("#buyRaw1").onclick = ()=>buyAsset("raw",1);
  $("#buyRaw10").onclick = ()=>buyAsset("raw",10);
  $("#buyCarved1").onclick = ()=>buyAsset("carved",1);
  $("#buyCarved10").onclick = ()=>buyAsset("carved",10);

  $("#sellRaw10").onclick = ()=>sell("raw",10);
  $("#sellRawAll").onclick = ()=>sell("raw",S.raw);
  $("#sellCarved10").onclick = ()=>sell("carved",10);
  $("#sellCarvedAll").onclick = ()=>sell("carved",S.carved);

  $("#tickNow").onclick = ()=>tickPrices(true);

  // save
  $("#saveBtn").onclick = save;
  $("#resetBtn").onclick = ()=>{
    if(!confirm("–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å?")) return;
    localStorage.removeItem("zf_pumpkin_square_trade"); location.reload();
  };
  $("#exportBtn").onclick = ()=>{
    const blob = new Blob([JSON.stringify(S,null,2)],{type:"application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "pumpkin_square_trade_save.json"; a.click();
  };
  $("#importBtn").onclick = ()=>{
    const input = document.createElement("input");
    input.type="file"; input.accept="application/json";
    input.onchange = async ()=>{
      const f = input.files[0]; if(!f) return;
      try{ const txt = await f.text(); const x = JSON.parse(txt);
        if(x && typeof x==="object"){ S={...S, ...x}; save(); hydrate(); }
      }catch(e){ alert("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–∞–π–ª"); }
    };
    input.click();
  };
}

// ====== INIT / LOOP ======
function hydrate(){
  setHeader();
  setPlotView();
  setPrices();
}
function autosave(){ save(); }

load();
hydrate();
bind();
setInterval(()=>{
  setPlotView(); // –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–æ–≤
  tickPrices(false);
}, 1000);
setInterval(autosave, CFG.autosaveSec*1000);
</script>
</body>
</html>
