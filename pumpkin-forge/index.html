<!DOCTYPE html>
<html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Pumpkin Forge ‚Äî A Zinken Forge Project</title><link rel="icon" href="icons/pumpkin.ico">
<style>
:root{--bg:#0a0f14;--panel:#0e131b;--ink:#eaf0f7;--muted:#a8b2c8;--line:rgba(255,255,255,.12);--ok:#57e389;--bad:#ff6b6b;--warn:#ffc24d;--info:#79c0ff;--accent:#ff8c2f}
*{box-sizing:border-box}html,body{height:100%}body{margin:0;background:radial-gradient(1200px 600px at 50% 100%,#123a19 0%, #0a0f14 60%);color:var(--ink);font:15px/1.45 Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;overflow-x:hidden}
a{color:inherit;text-decoration:none}.btn{cursor:pointer;background:#0f1621;color:var(--ink);border:1px solid var(--line);border-radius:10px;padding:8px 12px;font-weight:600}
.btn:hover{border-color:#fff;box-shadow:0 0 0 3px rgba(255,255,255,.08)}
.top-buttons{position:fixed;right:12px;top:10px;z-index:900;display:flex;gap:10px}.sound{width:42px;text-align:center}
.header{position:sticky;top:0;z-index:5;padding:10px 14px;background:rgba(10,15,20,.75);backdrop-filter:blur(6px);border-bottom:1px solid var(--line);display:flex;align-items:center;gap:14px;flex-wrap:wrap}
.brand{font-weight:800;letter-spacing:.4px}.brand b{color:var(--accent)}.sp{flex:1 1 auto}
.statpill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:#10131a;font-weight:600;white-space:nowrap}
.wrap{display:grid;grid-template-columns:320px 1fr;gap:18px;padding:14px;min-height:100vh}
.panel{background:rgba(10,14,22,.85);border:1px solid var(--line);border-radius:14px;padding:14px}.top{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:10px}
.title{font-weight:700}.nav-arrows{display:flex;gap:8px}.muted{color:var(--muted)}.footer{padding:12px 14px;color:var(--muted);border-top:1px solid var(--line);margin-top:8px}
.garden-panel{padding:8px;position:relative}.soil{margin:10px auto;width:min(980px,96vw);background:linear-gradient(180deg,#1a351d,#122016);border:3px solid #5a3d1f;border-radius:16px;padding:18px;box-shadow:inset 0 0 30px #0a0f14}
.grid-wrap{display:grid;grid-template-columns:40px 1fr;gap:10px;align-items:start}.scarecol{display:grid;gap:14px}
.scare{height:64px;display:flex;align-items:center;justify-content:center;border:1px dashed rgba(255,255,255,.18);border-radius:10px;background:#0f1a12;cursor:pointer;position:relative}
.scare.owned{background:#132516;border-style:solid;border-color:#2a6c3a}.scare .ico{font-size:18px}.scare .tag{position:absolute;bottom:6px;font-size:10px;opacity:.8}
.grid{display:grid;gap:14px;grid-template-columns:repeat(6,1fr)}.slot{height:64px;background:linear-gradient(180deg,#1a381f,#0f2614);border:1px solid rgba(0,0,0,.6);border-radius:10px;position:relative;overflow:hidden}
.slot .dash{position:absolute;inset:8px;border-radius:8px;border:1px dashed rgba(255,255,255,.12);pointer-events:none}
.badge{position:absolute;top:6px;right:6px;font-size:11px;padding:3px 6px;border-radius:8px;border:1px solid var(--line);background:#0d121c}
.b-water{color:var(--info);border-color:#295f8a}.b-grow{color:#b6ffb2;border-color:#2b6c3a}.b-dead{color:#ffd1d1;border-color:#6b2b2b}
.b-ready{color:#c8ffe0;border-color:#2b6c3a}.b-eaten{color:#ffe0ad;border-color:#7a5520}
.timer{position:absolute;left:8px;bottom:6px;font-size:11px;color:#d6e3ff;background:rgba(0,0,0,.25);padding:2px 6px;border-radius:6px;border:1px solid rgba(255,255,255,.12)}
.hint{color:var(--muted);font-size:12px;margin-top:6px}.locked-row{opacity:.35;filter:grayscale(40%)}.unlock{position:absolute;left:6px;top:6px;font-size:11px;padding:4px 8px;background:#24150b;border:1px solid #6b3b13;border-radius:8px;cursor:pointer}
.statgrid{display:flex;flex-direction:column;gap:8px}.statline{border:1px solid var(--line);background:#0b1020;border-radius:10px;padding:8px}
table.pr{width:100%;border-collapse:collapse;margin-top:6px}table.pr td{padding:6px 8px;border-bottom:1px solid var(--line)}table.pr tr:hover{background:#0f1420}
.toast{position:fixed;right:14px;bottom:14px;background:#111725;color:#eaf0f7;border:1px solid var(--line);border-radius:10px;padding:10px 12px;opacity:0;transform:translateY(10px);transition:.25s;z-index:1200}
.toast.show{opacity:1;transform:translateY(0)}.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:1100}
.modal .box{background:#0f1621;border:1px solid var(--line);border-radius:14px;padding:18px;width:min(520px,92vw)}.box h3{margin:0 0 8px 0}.box .row{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}

.seed.lock{opacity:.45;filter:grayscale(100%);cursor:not-allowed}
.btn.danger{background:#1e1111;border-color:#a33}.btn.danger:hover{box-shadow:0 0 0 2px rgba(255,80,80,.25)}
</style>
<script>
document.addEventListener('DOMContentLoaded', () => {
  [...document.querySelectorAll('a,button,li')].forEach(el => {
    if (el.textContent && el.textContent.trim().toLowerCase() === 'event') {
      el.remove();
    }
  });
});
</script>

</head>
<body>

<script>
(function(){
  const LEGACY_KEYS = ['pf_save_v3', 'pf_save_v3', 'pf_save_v3', 'pf_save_v3', 'pf_save_v3', 'pf_save_v3'];
  try { LEGACY_KEYS.forEach(k => localStorage.removeItem(k)); } catch(e) {}
  try { localStorage.setItem('pf_migrated_to_v3','1'); } catch(e) {}
})();
</script>

<div class="top-buttons"><a href="https://zinkenforge.ru" class="btn">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å–∞–π—Ç</a><button class="btn sound" id="btnSound">üîä</button></div>
<div class="header">
  <div class="brand">üéÉ <b>Pumpkin Forge</b></div><div class="sp"></div>
  
  
  
  
  
</div>
<div class="wrap">
  <aside class="panel">
    <div class="top"><div class="title"><span id="sectionTitle">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span></div><div class="nav-arrows"><button class="btn" id="prevSec">‚Üê</button><button class="btn" id="nextSec">‚Üí</button></div></div>
    <div id="sectionBody"></div>
    <div class="footer muted">–°—Ç—Ä–µ–ª–∫–∞–º–∏ –ª–∏—Å—Ç–∞–π —Ä–∞–∑–¥–µ–ª—ã: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Üí –ú–∞–≥–∞–∑–∏–Ω ‚Üí –î–æ–º —Ä–µ–∑—á–∏–∫–∞ ‚Üí –ë–∏—Ä–∂–∞ ‚Üí –†–µ–±—ë—Ä—Ç.</div>
  </aside>
  <main class="panel garden-panel">
    <div class="top">
      <div class="title">–û–≥–æ—Ä–æ–¥ 5√ó6</div>
      <div class="row">
        <button class="btn seed" data-seed="classic">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ ‚Äî 20$</button>
        <button class="btn seed" data-seed="rare">–≠–ø–∏—á–µ—Å–∫–∏–µ ‚Äî 35$</button>
        <button class="btn seed" data-seed="epic">–ú–∏—Ñ–∏—á–µ—Å–∫–∏–µ ‚Äî 60$</button>
        <button class="btn seed" data-seed="mythic">–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ ‚Äî 100$</button>
      </div>
      
    </div>
    <div class="soil"><div id="rowsContainer"></div><div class="hint">–ü–æ—Å–∞–¥–∫–∞ ‚Üí –ü–æ–ª–∏–≤ (—á–µ—Ä–µ–∑ 30—Å) ‚Üí –†–æ—Å—Ç (–¥–æ 60—Å) ‚Üí –°–±–æ—Ä. –ü—É–≥–∞–ª–æ ü™∂ —Å—Ç–∞–≤–∏—Ç—Å—è –∫–ª–∏–∫–æ–º –ø–æ –∏–∫–æ–Ω–∫–µ —Ä—è–¥–∞.</div></div>
  </main>
</div>
<div class="toast" id="toast">üíæ –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω</div>
<div class="modal" id="modal"><div class="box"><h3 id="modalTitle">–ó–∞–≥–æ–ª–æ–≤–æ–∫</h3><div id="modalBody">–¢–µ–∫—Å—Ç</div><div class="row"><button class="btn" id="modalClose">–û–∫</button></div></div></div>
<script>
// Sounds
const S={click:new Audio('assets/click.mp3'),water:new Audio('assets/water.mp3'),crow:new Audio('assets/crow.mp3'),harvest:new Audio('assets/harvest.mp3'),cut:new Audio('assets/cut.mp3'),notification:new Audio('assets/notification.mp3'),rebirth:new Audio('assets/rebirth.mp3'),music:new Audio('assets/calm_theme.mp3')};
for(const k in S){S[k].volume=(k==='music')?0.0:0.4} S.music.loop=true;
function fadeInMusic(){S.music.currentTime=0;S.music.play().catch(()=>{});let v=0.0;const t=setInterval(()=>{v+=.05;if(v>=.25){v=.25;clearInterval(t)}S.music.volume=v},150)}
let soundOn=true;document.getElementById('btnSound').onclick=()=>{soundOn=!soundOn;document.getElementById('btnSound').textContent=soundOn?'üîä':'üîà';const vol=soundOn?0.4:0.0;for(const k in S){S[k].volume=(k==='music')?(soundOn?.25:0.0):vol} if(soundOn)S.click.play().catch(()=>{})}
function play(a){if(soundOn)a.play().catch(()=>{})}
setTimeout(()=>{
  const sp=document.getElementById('splash');
  if(!sp) return;
  sp.classList.add('fade-out');
  fadeInMusic();
  setTimeout(()=>{ try{ sp.remove(); }catch(e){} }, 1500);
},6000);

// splash removed
setTimeout(()=>{ const sp=document.getElementById('splash'); if(sp){ try{ sp.remove(); }catch(e){} } }, 11000);

// utils
function el(t,c){const e=document.createElement(t);if(c)e.className=c;return e}
function fmt(s){const m=Math.floor(s/60),sec=s%60;return (m>0?(String(m).padStart(2,'0')+':'):'')+String(sec).padStart(2,'0')}
function toast(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),1800);play(S.notification)}
function showModal(t,b){const m=document.getElementById('modal');document.getElementById('modalTitle').textContent=t;document.getElementById('modalBody').innerHTML=b;m.style.display='flex'}
document.getElementById('modalClose').onclick=()=>document.getElementById('modal').style.display='none';
// config & state
const CFG={cols:6,rows:5,seedInfo:{classic:{cost:20,bad:.25,label:'–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ',needRebirth:0},rare:{cost:35,bad:.15,label:'–≠–ø–∏—á–µ—Å–∫–∏–µ',needRebirth:2},epic:{cost:60,bad:.10,label:'–ú–∏—Ñ–∏—á–µ—Å–∫–∏–µ',needRebirth:3},mythic:{cost:100,bad:.05,label:'–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ',needRebirth:4}},waterReadySec:30,matureSec:60,dieAfterNeedWaterSec:60,prices:{classic:40,rare:70,epic:120,mythic:200,GOLD:1000,CARVE_MULT:1.5},crowChancePerMin:.18,scarecrowCost:150,rowCosts:[0,250,500,1000,1500],waterRefillAmt:40,waterRefillCost:100,waterCapStep:10,waterCapCost:250,handsStep:10,handsCost:150,autosaveSec:30};
let state={money:100,selectedSeed:'classic',basket:[],handsCap:20,water:40,waterCap:40,rebirth:0,rowsUnlocked:[true,false,false,false,false],scarecrows:[false,false,false,false,false],goldCooldown:3,stats:{sold:0,carved:0,gold:0,totalHarvest:0,spoiled:0,eaten:0,timeStart:Date.now()}};
// save/load
const KEY='pumpkin_forge_v13';function save(){localStorage.setItem(KEY,JSON.stringify(state));toast('üíæ –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω.')}function load(){try{const r=localStorage.getItem(KEY);if(r){const s=JSON.parse(r);state=Object.assign(state,s);if(!Array.isArray(state.rowsUnlocked))state.rowsUnlocked=[true,false,false,false,false];if(!Array.isArray(state.scarecrows))state.scarecrows=[false,false,false,false,false]}}catch(e){}}load();setInterval(save,CFG.autosaveSec*1000);
// header
function countBasket(){const r={total:0,classic:0,rare:0,epic:0,mythic:0,gold:0,carved:0};for(const it of state.basket){r[it.kind]=(r[it.kind]||0)+1;r.total++}return r}
function updateHeader(){const c=countBasket();hMoney.textContent=Math.floor(state.money);hBasket.textContent=c.total+' —à—Ç.';hHands.textContent=c.total+' / '+state.handsCap;hWater.textContent=state.water+' / '+state.waterCap;hRebirth.textContent=state.rebirth;const ws=document.getElementById('waterStock');if(ws){ws.textContent='üíß –ó–∞–ø–∞—Å –≤–æ–¥—ã: '+state.water+' / '+state.waterCap;
  try{
    const ws=document.getElementById('waterStock'); if(ws){ ws.textContent='üíß –ó–∞–ø–∞—Å –≤–æ–¥—ã: '+state.water+' / '+state.waterCap; }
    const gm=document.getElementById('gardenMoney'); if(gm){ gm.textContent='üí∞ –ë–∞–ª–∞–Ω—Å: $'+Math.floor(state.money); }
    const gh=document.getElementById('gardenHands'); if(gh){ 
      const c=countBasket(); gh.textContent='ü§≤ –í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: '+c.total+' / '+state.handsCap;
    }
  }catch(e){}
}}
const rowsContainer=document.getElementById('rowsContainer');const cells=[];
function buildGarden(){rowsContainer.innerHTML='';cells.length=0;for(let r=0;r<CFG.rows;r++){const rowWrap=el('div','rowwrap');rowWrap.style.position='relative';const rowLocked=!state.rowsUnlocked[r];if(rowLocked)rowWrap.classList.add('locked-row');if(rowLocked){const u=el('button','unlock');u.textContent='–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ä—è–¥ ‚Äî $'+CFG.rowCosts[r];u.onclick=()=>{const cost=CFG.rowCosts[r];if(state.money<cost){showModal('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤','–ù—É–∂–Ω–æ $'+cost);return}state.money-=cost;state.rowsUnlocked[r]=true;buildGarden();
try{ refreshSeedButtons(); }catch(e){}

try{ if(typeof refreshSeedButtons==='function') refreshSeedButtons(); }catch(e){}
updateHeader()};rowWrap.appendChild(u)}
const sc=el('div','scare'+(state.scarecrows[r]?' owned':''));sc.innerHTML='<div class="ico">ü™∂</div><div class="tag">'+(r+1)+' —Ä—è–¥</div>';sc.title=state.scarecrows[r]?'–ü—É–≥–∞–ª–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ':'–ö—É–ø–∏—Ç—å –ø—É–≥–∞–ª–æ ($'+CFG.scarecrowCost+')';sc.onclick=()=>{if(!state.rowsUnlocked[r])return;if(state.scarecrows[r]){showModal('–ü—É–≥–∞–ª–æ','–£–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ.');return}if(state.money<CFG.scarecrowCost){showModal('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤','–ù—É–∂–Ω–æ $'+CFG.scarecrowCost);return}state.money-=CFG.scarecrowCost;state.scarecrows[r]=true;buildGarden();updateHeader();play(S.click)};const scareCol=el('div','scarecol');scareCol.appendChild(sc);rowWrap.appendChild(scareCol);
const grid=el('div','grid');for(let c=0;c<CFG.cols;c++){const slot=el('div','slot');slot.dataset.r=r;slot.dataset.c=c;slot.innerHTML='<div class="dash"></div><div class="timer" style="display:none">00:00</div>';if(rowLocked)slot.style.pointerEvents='none';grid.appendChild(slot);const cell={r,c,el:slot,seed:null,plantedAt:0,waterReadyAt:0,wateredAt:0,matureAt:0,deathDeadline:0,eaten:false,dead:false};cells.push(cell);slot.onclick=()=>onSlot(cell)}rowWrap.appendChild(grid);rowsContainer.appendChild(rowWrap)}}
buildGarden();
function refreshSeedButtons(){
  document.querySelectorAll('.seed').forEach(btn=>{
    const t = btn.dataset.seed;
    const need = (CFG.seedInfo[t] && CFG.seedInfo[t].needRebirth) || 0;
    btn.classList.remove('lock');
    btn.disabled = false;
    btn.removeAttribute('title');
    if(state.rebirth < need){
      btn.classList.add('lock');
      btn.disabled = true;
      btn.title = '–î–æ—Å—Ç—É–ø–Ω–æ —Å Rebirth ' + need;
    }
  });
}
// seed select
document.querySelectorAll('.seed').forEach(b=>b.addEventListener('click',()=>{document.querySelectorAll('.seed').forEach(x=>x.classList.remove('active'));b.classList.add('active');state.selectedSeed=b.dataset.seed;play(S.click)}));
document.querySelector('[data-seed="'+state.selectedSeed+'"]')?.classList.add('active');
function rollGolden(){ if(state.goldCooldown>0){state.goldCooldown--; return false;} const ok=Math.random()<0.02; if(ok) state.goldCooldown=3; return ok; }
function priceFor(kind,good,carved){if(kind==='gold')return CFG.prices.GOLD;const base=CFG.prices[kind]||0;const q=good?base:Math.max(5,base*.6);return carved?Math.round(q*CFG.prices.CARVE_MULT):q}
function resetCell(cell){Object.assign(cell,{seed:null,plantedAt:0,waterReadyAt:0,wateredAt:0,matureAt:0,deathDeadline:0,eaten:false,dead:false})}
function drawCell(cell){const el=cell.el;el.querySelectorAll('.badge')?.forEach(b=>b.remove());const t=el.querySelector('.timer');t.style.display='none';if(cell.eaten){addBadge(el,'–°—ä–µ–¥–µ–Ω–æ –≤–æ—Ä–æ–Ω–∞–º–∏','b-eaten');return}if(cell.dead){addBadge(el,'–ò—Å–ø–æ—Ä—Ç–∏–ª–æ—Å—å','b-dead');return}if(!cell.seed)return;const now=performance.now();if(cell.wateredAt===0){if(now<cell.waterReadyAt){addBadge(el,'–û–∂–∏–¥–∞–µ—Ç –ø–æ–ª–∏–≤–∞','b-water');const left=Math.max(0,Math.ceil((cell.waterReadyAt-now)/1000));t.textContent='–î–æ –ø–æ–ª–∏–≤–∞: '+fmt(left);t.style.display='block'}else{if(!cell.deathDeadline)cell.deathDeadline=now+CFG.dieAfterNeedWaterSec*1000;const left=Math.max(0,Math.ceil((cell.deathDeadline-now)/1000));if(left>0){addBadge(el,'–ü–æ–ª–∏–≤','b-water');t.textContent='–ü–æ–≥–∏–±–Ω–µ—Ç —á–µ—Ä–µ–∑: '+fmt(left);t.style.display='block'}else{cell.dead=true;addBadge(el,'–ò—Å–ø–æ—Ä—Ç–∏–ª–æ—Å—å','b-dead')}}}else{if(now<cell.matureAt){addBadge(el,'–†–æ—Å—Ç','b-grow');const left=Math.max(0,Math.ceil((cell.matureAt-now)/1000));t.textContent='–î–æ —Å–±–æ—Ä–∞: '+fmt(left);t.style.display='block'}else{addBadge(el,'–ì–æ—Ç–æ–≤–æ','b-ready');t.textContent='–°–æ–±–µ—Ä–∏';t.style.display='block'}}}
function addBadge(el,txt,cls){const b=document.createElement('div');b.className='badge '+cls;b.textContent=txt;el.appendChild(b)}
function onSlot(cell){const now=performance.now();if(cell.eaten||cell.dead){resetCell(cell);drawCell(cell);return}if(cell.seed&&cell.wateredAt>0&&now>=cell.matureAt){const c=countBasket();if(c.total>=state.handsCap){showModal('–†—É–∫–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω—ã','–ü—Ä–æ–¥–∞–π —É—Ä–æ–∂–∞–π –Ω–∞ –±–∏—Ä–∂–µ –∏–ª–∏ —É–≤–µ–ª–∏—á—å –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å.');return}const info=CFG.seedInfo[cell.seed]||CFG.seedInfo.classic;const bad=Math.random()<info.bad;const golden=rollGolden();const kind=golden?'gold':cell.seed;state.basket.push({kind,good:!bad,carved:false,at:Date.now()});if(golden)state.stats.gold++;state.stats.totalHarvest++;play(S.harvest);resetCell(cell);drawCell(cell);updateHeader();renderSection();return}
if(cell.seed&&cell.wateredAt===0){if(now<cell.waterReadyAt){showModal('–†–∞–Ω–æ –ø–æ–ª–∏–≤–∞—Ç—å','–ü–æ–¥–æ–∂–¥–∏ —Ç–∞–π–º–µ—Ä ¬´–î–æ –ø–æ–ª–∏–≤–∞¬ª.');return}if(state.water<=0){showModal('–ù–µ—Ç –≤–æ–¥—ã','–ö—É–ø–∏ –≤–æ–¥—É –≤ –ú–∞–≥–∞–∑–∏–Ω–µ.');return}state.water-=1;play(S.water);cell.wateredAt=now;cell.matureAt=now+CFG.matureSec*1000;cell.deathDeadline=0;drawCell(cell);updateHeader();return}
if(!cell.seed){const info=CFG.seedInfo[state.selectedSeed]||CFG.seedInfo.classic;if(state.money<info.cost){showModal('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤','–ù—É–∂–Ω–æ $'+info.cost);return}state.money-=info.cost;play(S.click);Object.assign(cell,{seed:state.selectedSeed,plantedAt:now,waterReadyAt:now+CFG.waterReadySec*1000,wateredAt:0,matureAt:0,deathDeadline:0,eaten:false,dead:false});drawCell(cell);updateHeader();renderSection();return}
showModal('–ï—â—ë —Ä–∞—Å—Ç—ë—Ç‚Ä¶','–î–æ–∂–¥–∏—Å—å ¬´–î–æ —Å–±–æ—Ä–∞¬ª.')}
// ticks
setInterval(()=>{for(const c of cells)drawCell(c);for(const k of ['classic','rare','epic','mythic']){const d=(Math.random()-0.5)*22;CFG.prices[k]=Math.max(8,Math.round(CFG.prices[k]+d))}updateHeader()},1000);
// crows
setInterval(()=>{if(Math.random()<CFG.crowChancePerMin){const rows=[];for(let r=0;r<CFG.rows;r++)if(state.rowsUnlocked[r]&&!state.scarecrows[r])rows.push(r);if(!rows.length)return;const row=rows[Math.floor(Math.random()*rows.length)];const cand=cells.filter(c=>c.r===row&&c.seed&&((c.wateredAt===0)||(performance.now()<c.matureAt)));if(cand.length){const v=cand[Math.floor(Math.random()*cand.length)];v.eaten=true;state.stats.eaten++;drawCell(v);play(S.crow)}}},60000);
// sections
const sections=['stats','shop','cutter','exchange','rebirth'];let si=0;let cur=sections[si];
const sectionTitle=document.getElementById('sectionTitle');const sectionBody=document.getElementById('sectionBody');
prevSec.onclick=()=>{si=(si-1+sections.length)%sections.length;switchSec()};nextSec.onclick=()=>{si=(si+1)%sections.length;switchSec()};
function switchSec(){cur=sections[si];const t={info:'–ò–Ω—Ñ–æ', stats:'–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',shop:'–ú–∞–≥–∞–∑–∏–Ω',cutter:'–î–æ–º —Ä–µ–∑—á–∏–∫–∞',exchange:'–ë–∏—Ä–∂–∞',rebirth:'–†–µ–±—ë—Ä—Ç'};sectionTitle.textContent=t[cur]||cur;renderSec()}
switchSec();
function renderSec(){
 if(cur==='info'){
   const c = countBasket();
   sectionBody.innerHTML = `
     <div class="statgrid">
       <div class="statline">üí∞ –ë–∞–ª–∞–Ω—Å: <b>$${Math.floor(state.money)}</b></div>
       <div class="statline">üß∫ –ö–æ—Ä–∑–∏–Ω–∞ (–≤ —Ä—É–∫–∞—Ö): <b>${c.total} / ${state.handsCap}</b></div>
       <div class="statline">üíß –í–æ–¥–∞: <b>${state.water} / ${state.waterCap}</b></div>
       <div class="statline">üìà –†–µ–±—ë—Ä—Ç: <b>${state.rebirth}</b></div>
       <div class="statline">üß± –†—è–¥–æ–≤ –æ—Ç–∫—Ä—ã—Ç–æ: <b>${1 + state.rowsUnlocked.filter(Boolean).length}</b> –∏–∑ 6</div>
     </div>`;
   updateHeader();
   return;
 }

 if(cur==='stats'){const c=countBasket();sectionBody.innerHTML=`
  <div class="statgrid">
    <div class="statline">üí∞ –ë–∞–ª–∞–Ω—Å: <b>$${Math.floor(state.money)}</b></div>
    <div class="statline">üíß –í–æ–¥–∞: <b>${state.water}/${state.waterCap}</b></div>
    <div class="statline">ü§≤ –í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: <b>${c.total}/${state.handsCap}</b></div>
    <div class="statline">üß∫ –ö–æ—Ä–∑–∏–Ω–∞:
      <div>–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ: ${c.classic}</div>
      <div>–≠–ø–∏—á–µ—Å–∫–∏–µ: ${c.rare}</div>
      <div>–ú–∏—Ñ–∏—á–µ—Å–∫–∏–µ: ${c.epic}</div>
      <div>–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ: ${c.mythic}</div>
      <div>–ó–æ–ª–æ—Ç—ã–µ: ${c.gold}</div>
      <div>–ù–∞—Ä–µ–∑–∞–Ω–Ω—ã–µ: ${c.carved}</div>
    </div>
    <div class="statline">üìà –†–µ–±—ë—Ä—Ç: <b>${state.rebirth}</b></div>
  </div>
  <div class="row" style="margin-top:10px;">
    <button class="btn danger" id="btnReset">–ù–∞—á–∞—Ç—å –≤—Å—ë —Å–Ω–∞—á–∞–ª–∞</button>
  </div>
`}
 if(cur==='shop'){
  sectionBody.innerHTML = `
    <div class="row">
      <button class="btn" id="buyWater">–ö—É–ø–∏—Ç—å –≤–æ–¥—É (+${CFG.waterRefillAmt}) ‚Äî $${CFG.waterRefillCost}</button>
      <button class="btn" id="upWater">–£–ª—É—á—à–∏—Ç—å –±–∞–∫ (+${CFG.waterCapStep}) ‚Äî $${CFG.waterCapCost}</button>
      <button class="btn" id="upHands">–£–ª—É—á—à–∏—Ç—å —Ä—É–∫–∏ (+${CFG.handsStep}) ‚Äî $${CFG.handsCost}</button>
    </div>
    <div class="row" id="rowBuyWrap"></div>
    <div class="muted">–°–µ–º–µ–Ω–∞ –≤—ã–±–∏—Ä–∞—é—Ç—Å—è –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–æ–∑–ª–µ –æ–≥–æ—Ä–æ–¥–∞. –ü–æ–∫—É–ø–∫–∞ —Ä—è–¥–æ–≤ ‚Äî –∑–¥–µ—Å—å.</div>`;

  // Resource controls
  sectionBody.querySelector('#buyWater').onclick=()=>{
    if(state.money<CFG.waterRefillCost) return showModal('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤','–ù—É–∂–Ω–æ $'+CFG.waterRefillCost);
    state.money-=CFG.waterRefillCost; state.water=Math.min(state.waterCap,state.water+CFG.waterRefillAmt);
    play(S.click); updateHeader(); renderSec();
  };
  sectionBody.querySelector('#upWater').onclick=()=>{
    if(state.money<CFG.waterCapCost) return showModal('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤','–ù—É–∂–Ω–æ $'+CFG.waterCapCost);
    state.money-=CFG.waterCapCost; state.waterCap+=CFG.waterCapStep;
    play(S.click); updateHeader(); renderSec();
  };
  sectionBody.querySelector('#upHands').onclick=()=>{
    if(state.money<CFG.handsCost) return showModal('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤','–ù—É–∂–Ω–æ $'+CFG.handsCost);
    state.money-=CFG.handsCost; state.handsCap+=CFG.handsStep;
    play(S.click); updateHeader(); renderSec();
  };

  // Buy Row dynamic
  (function(){
    const wrap = sectionBody.querySelector('#rowBuyWrap');
    const opened = 1 + (state.rowsUnlocked ? state.rowsUnlocked.filter(Boolean).length : 0);
    const btn = document.createElement('button'); btn.className='btn'; btn.id='buyRow';
    if(opened < 6){
      const next = opened + 1;
      const cost = 500 * (next - 1);
      btn.textContent = `–ö—É–ø–∏—Ç—å –Ω–æ–≤—ã–π —Ä—è–¥ ‚Äî $${cost}`;
      btn.onclick = ()=>{
        const openedNow = 1 + (state.rowsUnlocked ? state.rowsUnlocked.filter(Boolean).length : 0);
        if(openedNow >= 6) return;
        const nxt = openedNow + 1;
        const cst = 500 * (nxt - 1);
        if(state.money < cst){ showModal('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤','–ù—É–∂–Ω–æ $'+cst); return; }
        state.money -= cst;
        if(!Array.isArray(state.rowsUnlocked)) state.rowsUnlocked=[true,false,false,false,false];
        state.rowsUnlocked[openedNow-1] = true;
        if(typeof buildGarden==='function') buildGarden();
        updateHeader(); renderSec(); if(typeof save==='function') save();
      };
    } else {
      btn.textContent = '–í—Å–µ —Ä—è–¥—ã –∫—É–ø–ª–µ–Ω—ã ‚úÖ';
      btn.disabled = true;
    }
    wrap.appendChild(btn);
  })();
}
if(cur==='cutter'){const c=countBasket();const can=(c.classic+c.rare+c.epic+c.mythic)>0;sectionBody.innerHTML=`
  <div class="statline">–ù–∞—Ä–µ–∑–∞–Ω–Ω—ã–µ —Ç—ã–∫–≤—ã: <b>${c.carved}</b></div>
  <div class="row"><button class="btn" id="cutOne" ${can?'':'disabled'}>–ù–∞—Ä–µ–∑–∞—Ç—å 1 —Ç—ã–∫–≤—É (5 —Å–µ–∫)</button></div>
  <div class="muted">–ù–∞—Ä–µ–∑–∞–Ω–Ω–∞—è —Ç—ã–∫–≤–∞ –ø—Ä–æ–¥–∞—ë—Ç—Å—è –¥–æ—Ä–æ–∂–µ (√ó${CFG.prices.CARVE_MULT}).</div>
  <div id="cutStatus" class="muted"></div>`;
  sectionBody.querySelector('#cutOne').onclick=()=>{const i=state.basket.findIndex(x=>x.kind!=='gold'&&x.kind!=='carved');if(i<0)return showModal('–ù–µ—Ç —Ç—ã–∫–≤','–°–Ω–∞—á–∞–ª–∞ —Å–æ–±–µ—Ä–∏ —É—Ä–æ–∂–∞–π.');state.basket.splice(i,1);document.getElementById('cutStatus').textContent='–†–µ–∂–µ–º‚Ä¶ (5 —Å–µ–∫)';play(S.cut);setTimeout(()=>{state.basket.push({kind:'carved',good:true,carved:true,at:Date.now()});state.stats.carved++;document.getElementById('cutStatus').textContent='–ì–æ—Ç–æ–≤–æ: +1 –Ω–∞—Ä–µ–∑–∞–Ω–Ω–∞—è —Ç—ã–∫–≤–∞.';renderSec();updateHeader()},5000)};
 }
 if(cur==='exchange'){const c=countBasket();sectionBody.innerHTML=`
  <div class="statline"><b>–†—ã–Ω–æ—á–Ω—ã–µ —Ü–µ–Ω—ã</b>
    <table class="pr">
      <tr><td>–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ</td><td><b>$${CFG.prices.classic}</b></td><td>–í –∫–æ—Ä–∑–∏–Ω–µ: ${c.classic}</td></tr>
      <tr><td>–≠–ø–∏—á–µ—Å–∫–∏–µ</td><td><b>$${CFG.prices.rare}</b></td><td>–í –∫–æ—Ä–∑–∏–Ω–µ: ${c.rare}</td></tr>
      <tr><td>–ú–∏—Ñ–∏—á–µ—Å–∫–∏–µ</td><td><b>$${CFG.prices.epic}</b></td><td>–í –∫–æ—Ä–∑–∏–Ω–µ: ${c.epic}</td></tr>
      <tr><td>–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ</td><td><b>$${CFG.prices.mythic}</b></td><td>–í –∫–æ—Ä–∑–∏–Ω–µ: ${c.mythic}</td></tr>
      <tr><td>–ó–æ–ª–æ—Ç—ã–µ</td><td><b>$${CFG.prices.GOLD}</b></td><td>–í –∫–æ—Ä–∑–∏–Ω–µ: ${c.gold}</td></tr>
      <tr><td>–ù–∞—Ä–µ–∑–∞–Ω–Ω—ã–µ</td><td><b>√ó${CFG.prices.CARVE_MULT}</b></td><td>–í –∫–æ—Ä–∑–∏–Ω–µ: ${c.carved}</td></tr>
    </table>
  </div>
  <div class="row">
    <button class="btn" id="sellAll">–ü—Ä–æ–¥–∞—Ç—å –≤—Å—ë (${c.total})</button>
    <button class="btn sell" data-kind="classic">–ü—Ä–æ–¥–∞—Ç—å –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ (${c.classic})</button>
    <button class="btn sell" data-kind="rare">–ü—Ä–æ–¥–∞—Ç—å —ç–ø–∏—á–µ—Å–∫–∏–µ (${c.rare})</button>
    <button class="btn sell" data-kind="epic">–ü—Ä–æ–¥–∞—Ç—å –º–∏—Ñ–∏—á–µ—Å–∫–∏–µ (${c.epic})</button>
    <button class="btn sell" data-kind="mythic">–ü—Ä–æ–¥–∞—Ç—å –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ (${c.mythic})</button>
    <button class="btn sell" data-kind="gold">–ü—Ä–æ–¥–∞—Ç—å –∑–æ–ª–æ—Ç—ã–µ (${c.gold})</button>
    <button class="btn sell" data-kind="carved">–ü—Ä–æ–¥–∞—Ç—å –Ω–∞—Ä–µ–∑–∞–Ω–Ω—ã–µ (${c.carved})</button>
  </div>
  <div id="sellResult" class="muted"></div>`;
  function doSell(fn,label){let sold=0,sum=0,rest=[];for(const p of state.basket){if(fn(p)){sum+=priceFor(p.kind,p.good,p.kind==='carved');sold++}else rest.push(p)}state.basket=rest;state.money+=sum;state.stats.sold+=sold;document.getElementById('sellResult').textContent=`${label}: –ø—Ä–æ–¥–∞–Ω–æ ${sold}, +$${Math.round(sum)}`;play(S.click);updateHeader();renderSec()}
  document.getElementById('sellAll').onclick=()=>doSell(()=>true,'–í—Å–µ');
  sectionBody.querySelectorAll('.sell').forEach(b=>b.onclick=()=>{const k=b.dataset.kind;doSell(p=>p.kind===k,b.textContent)});
 }
 if(cur==='rebirth'){
  sectionBody.innerHTML=`
    <div class="statline"><b>–¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å:</b> ${state.rebirth}</div>
    <div class="row">
      <button class="btn" id="checkRb">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å</button>
      <button class="btn" id="doRb" disabled>–ü–µ—Ä–µ—Ä–æ–¥–∏—Ç—å—Å—è</button>
    </div>
    <div id="rbHint" class="muted"></div>`;

  let can = false;
  const checkBtn = sectionBody.querySelector('#checkRb');
  const doBtn = sectionBody.querySelector('#doRb');
  const hint = sectionBody.querySelector('#rbHint');

  checkBtn.onclick = () => {
    const r = chkRbExplain();
    if (r.ok) {
      can = true;
      if (doBtn) doBtn.disabled = false;
      hint.textContent = '‚úÖ –ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ.';
      showModal('–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π', '‚úÖ –ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ.');
    } else {
      can = false;
      if (doBtn) doBtn.disabled = true;
      let msg = r.msg || '';
      const m = msg.match(/(\d+)\s*\/\s*(\d+)/);
      if (m) {
        const a = parseInt(m[1],10), b = parseInt(m[2],10);
        msg = `–ù—É–∂–Ω–æ: ${b} / –û—Å—Ç–∞–ª–æ—Å—å: ${Math.max(0,b-a)}`;
      }
      hint.textContent = msg;
      showModal('–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π', msg);
    }
    try{ S.click.currentTime=0; S.click.play(); }catch(_){}
  };

  doBtn.onclick = () => {
    // –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    const okNow = chkRb();
    if (!can && !okNow) return;
    state.rebirth = (state.rebirth||0) + 1;
    try{ refreshSeedButtons(); }catch(e){}
try{ S.rebirth.currentTime=0; S.rebirth.play(); }catch(_){}
    try{ if(typeof refreshSeedButtons==='function') refreshSeedButtons(); }catch(_){}
    try{ if(typeof save==='function') save(); }catch(_){}
    showModal('–ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ', `<p>üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –£—Ä–æ–≤–µ–Ω—å Rebirth ${state.rebirth} –¥–æ—Å—Ç–∏–≥–Ω—É—Ç.</p>`);
    updateHeader(); renderSec();
  };
}
 updateHeader();
}

function chkRb(){
  // Rebirth I: must have at least one scarecrow purchased
  if(state.rebirth===0) {
    try{ return Array.isArray(state.scarecrows) && state.scarecrows.some(Boolean); }catch(_){ return false; }
  }
  if(state.rebirth===1) return (state.stats && state.stats.sold>=20);
  if(state.rebirth===2) return (state.money>=5000);
  if(state.rebirth===3) return (state.stats && state.stats.carved>=10);
  if(state.rebirth===4) return (state.money>=25000);
  return false;
}


function chkRbExplain(){
  if(state.rebirth===0){
    const ok = Array.isArray(state.scarecrows) && state.scarecrows.some(Boolean);
    return ok ? {ok:true,msg:'–ì–æ—Ç–æ–≤ –∫ Rebirth I'} : {ok:false,msg:'–ù—É–∂–Ω–æ: –ø—É–≥–∞–ª–æ (1 —à—Ç) / –û—Å—Ç–∞–ª–æ—Å—å: 1'};
  }
  if(state.rebirth===1){
    const need=20, have=(state.stats?.sold||0);
    return have>=need ? {ok:true,msg:'–ì–æ—Ç–æ–≤ –∫ Rebirth II'} : {ok:false,msg:'–ù—É–∂–Ω–æ: '+need+' / –û—Å—Ç–∞–ª–æ—Å—å: '+Math.max(0,need-have)};
  }
  if(state.rebirth===2){
    const need=5000, have=Math.floor(state.money||0);
    return have>=need ? {ok:true,msg:'–ì–æ—Ç–æ–≤ –∫ Rebirth III'} : {ok:false,msg:'–ù—É–∂–Ω–æ: '+need+' / –û—Å—Ç–∞–ª–æ—Å—å: '+Math.max(0,need-have)};
  }
  if(state.rebirth===3){
    const need=10, have=(state.stats?.carved||0);
    return have>=need ? {ok:true,msg:'–ì–æ—Ç–æ–≤ –∫ Rebirth IV'} : {ok:false,msg:'–ù—É–∂–Ω–æ: '+need+' / –û—Å—Ç–∞–ª–æ—Å—å: '+Math.max(0,need-have)};
  }
  if(state.rebirth===4){
    const need=25000, have=Math.floor(state.money||0);
    return have>=need ? {ok:true,msg:'–ì–æ—Ç–æ–≤ –∫ Rebirth V'} : {ok:false,msg:'–ù—É–∂–Ω–æ: '+need+' / –û—Å—Ç–∞–ª–æ—Å—å: '+Math.max(0,need-have)};
  }
  return {ok:false,msg:'–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç.'};
}
// draw/tick
const allBadges=()=>cells.forEach(drawCell);function tick(){allBadges();requestAnimationFrame(tick)}tick();updateHeader();try{ refreshSeedButtons(); }catch(e){}
renderSec();toast('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Pumpkin Forge');
</script>
  <div class="card" id="saves_card" style="margin-top:16px">
    <h3 style="margin:0 0 10px">–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è</h3>
    <div class="row">
      <button class="btn" id="pf_save_btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button class="btn" id="pf_load_btn">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
      <button class="btn" id="pf_export_btn">–≠–∫—Å–ø–æ—Ä—Ç</button>
      <button class="btn" id="pf_import_btn">–ò–º–ø–æ—Ä—Ç</button>
      <button class="btn" id="pf_reset_btn">–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
      <span class="small">–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (–≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ).</span>
    </div>
  </div>


<script>
// ----- Seeds always available: force-enable any seed buttons/controls -----
(function(){
  function enableSeeds(){
    const candidates = Array.from(document.querySelectorAll('button, input, a, select'));
    candidates.forEach(el => {
      const t = (el.textContent || el.value || '').toLowerCase();
      if (t.includes('—Å–µ–º—è–Ω') || t.includes('—Å–µ–º–µ–Ω–∞') || t.includes('—Å–µ–º—è') || t.includes('seed')) {
        el.disabled = false;
        el.classList.remove('disabled');
        el.style.pointerEvents = 'auto';
        el.style.opacity = '';
      }
    });
  }
  const mo = new MutationObserver(enableSeeds);
  mo.observe(document.documentElement, {subtree:true, childList:true, attributes:true});
  document.addEventListener('DOMContentLoaded', enableSeeds);
  window.addEventListener('load', enableSeeds);
  setInterval(enableSeeds, 1000);
})();

// ----- Save/Load helpers (pf_save_v3) -----
(function(){
  const KEY = 'pf_save_v3';

  function smartSave(){
    try{
      if (window.S && typeof window.S === 'object') {
        localStorage.setItem(KEY, JSON.stringify(window.S));
      } else if (window.save && typeof window.save === 'function') {
        // fallback to game save if provided
        window.save();
      } else {
        // snapshot minimal page state (very generic fallback)
        localStorage.setItem(KEY, JSON.stringify({ts: Date.now()}));
      }
      alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ.');
    }catch(e){ alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å: '+e); }
  }

  function smartLoad(){
    try{
      const raw = localStorage.getItem(KEY);
      if (!raw) { alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.'); return; }
      const data = JSON.parse(raw);
      if (window.S && typeof window.S === 'object') {
        Object.assign(window.S, data);
        // –ø—Ä–æ–±—É–µ–º –≤—ã–∑–≤–∞—Ç—å —Ä–µ–Ω–¥–µ—Ä-–∞–ø–¥–µ–π—Ç–µ—Ä—ã, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
        (window.hydrate||window.render||window.setHeader||function(){})();
        if (window.setPlotView) window.setPlotView();
        if (window.setPrices) window.setPrices();
      } else if (window.load && typeof window.load === 'function') {
        window.load();
      }
      alert('–ó–∞–≥—Ä—É–∂–µ–Ω–æ.');
    }catch(e){ alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å: '+e); }
  }

  function smartExport(){
    try{
      const raw = localStorage.getItem(KEY) || '{}';
      const blob = new Blob([raw], {type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'pumpkin_forge_save.json';
      a.click();
    }catch(e){ alert('–≠–∫—Å–ø–æ—Ä—Ç –Ω–µ —É–¥–∞–ª—Å—è: '+e); }
  }

  function smartImport(){
    const inp = document.createElement('input');
    inp.type = 'file'; inp.accept = 'application/json';
    inp.onchange = async () => {
      const f = inp.files && inp.files[0];
      if(!f) return;
      try{
        const txt = await f.text();
        JSON.parse(txt); // –ø—Ä–æ–≤–µ—Ä–∫–∞
        localStorage.setItem(KEY, txt);
        smartLoad();
      }catch(e){ alert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–∞–π–ª: '+e); }
    };
    inp.click();
  }

  function smartReset(){
    if(!confirm('–°—Ç–µ—Ä–µ—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å? –î–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.')) return;
    try{
      localStorage.removeItem(KEY);
      // –¢–∞–∫–∂–µ —Å–Ω–æ—Å–∏–º –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç–∞—Ä—ã–µ –∫–ª—é—á–∏, –µ—Å–ª–∏ –≤–¥—Ä—É–≥ –æ—Å—Ç–∞–ª–∏—Å—å
      ['zf_pumpkin_square','zf_pumpkin_square_trade','pf_save_v1','pf_save_v2','pf_save','pumpkin_save']
        .forEach(k=>{try{localStorage.removeItem(k)}catch(e){}});
      location.reload();
    }catch(e){ alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–±—Ä–æ—Å–∏—Ç—å: '+e); }
  }

  // bind buttons if present
  function bindSaveUI(){
    const byId = id => document.getElementById(id);
    byId('pf_save_btn')  && (byId('pf_save_btn').onclick  = smartSave);
    byId('pf_load_btn')  && (byId('pf_load_btn').onclick  = smartLoad);
    byId('pf_export_btn')&& (byId('pf_export_btn').onclick= smartExport);
    byId('pf_import_btn')&& (byId('pf_import_btn').onclick= smartImport);
    byId('pf_reset_btn') && (byId('pf_reset_btn').onclick = smartReset);
  }
  document.addEventListener('DOMContentLoaded', bindSaveUI);
  window.addEventListener('load', bindSaveUI);
})();
</script>

<footer style="max-width:1100px;margin:24px auto 36px;padding:0 16px;color:#9aa3b2;font-size:12px">¬© 2025 Zinken Forge ‚Äî –≤—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</footer>
</body></html>
<script>
// –≥–ª–æ–±–∞–ª—å–Ω—ã–π –¥–µ–ª–µ–≥–∞—Ç –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å–±—Ä–æ—Å–∞ (—á—Ç–æ–±—ã –Ω–µ —Ç–µ—Ä—è—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–µ)
document.addEventListener('click', function(e){
  const btn = e.target.closest && e.target.closest('#btnReset');
  if(!btn) return;
  if(!confirm('–£–¥–∞–ª–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.')) return;
  try{ localStorage.removeItem('pumpkin_forge_v13'); }catch(_){}
  // –ë–∞–∑–æ–≤—ã–π —Å–±—Ä–æ—Å state
  state={money:100,selectedSeed:'classic',basket:[],handsCap:20,water:40,waterCap:40,rebirth:0,
         rowsUnlocked:[true,false,false,false,false],scarecrows:[false,false,false,false,false],
         goldCooldown:3,stats:{sold:0,carved:0,gold:0,totalHarvest:0,spoiled:0,eaten:0,timeStart:Date.now()}};
  try{ buildGarden(); updateHeader(); renderSec(); }catch(_){}
  toast('üîÑ –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω');
});
</script>

<script>window.pfFinalCongratsText = `üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –¢—ã –ø—Ä–æ—à—ë–ª –±–∞–∑–æ–≤—ã–π –∫—É—Ä—Å. –≠—Ç–∞ –∏–≥—Ä–∞ ‚Äî –±–æ–ª—å—à–µ, —á–µ–º —Å–∏–º—É–ª—è—Ü–∏—è: –æ–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ —Ç—Ä—É–¥, –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞—é—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç. Pumpkin Forge ‚Äî —ç—Ç–æ –Ω–∞—á–∞–ª–æ –º—ã—à–ª–µ–Ω–∏—è Zinken Forge.`;</script>
